<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>User Dashboard</title>
</head>
<body style="background: linear-gradient(145deg, rgba(250, 250, 253, 0.9) 0%, rgba(220, 227, 255, 0.9) 100%), url('https://images.unsplash.com/photo-1556740738-6b4d43b29b73?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80') no-repeat center center fixed; background-size: cover; min-height: 100vh; font-family: 'Montserrat', Arial, sans-serif; margin: 0; padding: 30px; display: flex; justify-content: center; align-items: flex-start;">
<div style="max-width: 1280px; margin: 0 auto; padding: 40px; background-color: rgba(255, 255, 255, 0.97); border-radius: 20px; box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15); backdrop-filter: blur(12px);">
  <h2 style="color: #1a1a1a; font-size: 36px; font-weight: 700; margin-bottom: 40px; text-align: center; letter-spacing: 1px; text-transform: uppercase; background: linear-gradient(to right, #3f51b5, #7c4dff); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">User Dashboard</h2>
  <a href="/user/cart" style="display: inline-block; float: right; padding: 14px 28px; background: linear-gradient(90deg, #ff6f00, #ffab40); color: #fff; text-decoration: none; border-radius: 10px; font-size: 16px; font-weight: 600; margin-bottom: 30px; transition: transform 0.3s ease, box-shadow 0.3s ease, background 0.3s ease;" onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 8px 20px rgba(255, 111, 0, 0.5);'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='none';">ðŸ›’ View Cart</a><br/>

  <div style="display: flex; flex-wrap: wrap; gap: 30px; clear: both;">
    <div class="col-md-4 mb-4" th:each="product : ${products}" style="flex: 1 1 calc(33.333% - 30px); max-width: calc(33.333% - 30px);">
      <div style="background-color: #fff; border-radius: 15px; overflow: hidden; box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12); transition: transform 0.4s ease, box-shadow 0.4s ease;" onmouseover="this.style.transform='scale(1.04)'; this.style.boxShadow='0 12px 30px rgba(0, 0, 0, 0.2);'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 8px 25px rgba(0, 0, 0, 0.12);'">
        <img th:src="@{'/images/' + ${product.imageName}}"
             style="width: 100%; height: 240px; object-fit: cover; border-bottom: 2px solid #f5f5f5; transition: transform 0.3s ease;" onmouseover="this.style.transform='scale(1.05)';">

        <div style="padding: 25px;">
          <h5 style="color: #222; font-size: 22px; font-weight: 700; margin: 0 0 12px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; letter-spacing: 0.5px;" th:text="${product.name}"></h5>
          <p style="color: #555; font-size: 15px; margin: 0 0 15px; line-height: 1.6; max-height: 64px; overflow: hidden; font-weight: 400;" th:text="${product.description}"></p>
          <p style="color: #d81b60; font-size: 20px; font-weight: 700; margin: 0 0 20px; letter-spacing: 0.5px;"><strong>â‚¹</strong> <span th:text="${product.price}"></span></p>

          <!-- Stock Reservation Block -->
          <th:block th:with="reservedMap=${session.reservedStock},
                             reservedQty=${reservedMap != null and reservedMap[product.id] != null ? reservedMap[product.id] : 0},
                             availableStock=${product.stock - reservedQty}">

            <p style="color: #666; font-size: 15px; margin: 0 0 20px; font-weight: 500; letter-spacing: 0.3px;" class="card-text text-muted">
              Available: <span th:text="${availableStock}"></span>
            </p>

            <!-- If stock is available -->
            <a th:if="${availableStock > 0}"
               th:href="@{'/user/add-to-cart/' + ${product.id}}"
               style="display: inline-block; width: 100%; text-align: center; padding: 12px; background: linear-gradient(90deg, #3f51b5, #7c4dff); color: #fff; text-decoration: none; border-radius: 10px; font-size: 15px; font-weight: 600; transition: transform 0.3s ease, box-shadow 0.3s ease;" onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 6px 15px rgba(63, 81, 181, 0.5);'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='none';">
              Add to Cart
            </a>

            <!-- If stock is unavailable -->
            <button th:if="${availableStock <= 0}"
                    style="width: 100%; padding: 12px; background: #e0e0e0; color: #777; border: none; border-radius: 10px; font-size: 15px; font-weight: 600; cursor: not-allowed; opacity: 0.8;">
              Out of Stock
            </button>
          </th:block>
        </div>
      </div>
    </div>
  </div>
</div>
</body>
</html>